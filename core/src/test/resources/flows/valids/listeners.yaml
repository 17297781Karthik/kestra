id: listeners
namespace: org.floworc.tests

inputs:
  - name: string
    type: STRING

listeners:
  - conditions:
      - type: org.floworc.core.models.listeners.types.ExecutionStatusCondition
        in:
          - FAILED
    tasks:
      - id: execution-failed-listener
        type: org.floworc.core.tasks.scripts.Bash
        commands:
          - 'sleep 1'

  - conditions:
      - type: org.floworc.core.models.listeners.types.ExecutionStatusCondition
        in:
          - SUCCESS
    tasks:
      - id: execution-success-listener
        type: org.floworc.core.tasks.debugs.Return
        format: success listeners {{ execution.id }}

tasks:
  - id: parent-seq
    type: org.floworc.core.tasks.flows.Switch
    value: "{{inputs.string}}"
    cases:
      OK:
        - id: ok
          type: org.floworc.core.tasks.debugs.Return
          format: "{{task.id}} > {{taskrun.startDate}}"
      KO:
        - id: ko
          type: org.floworc.core.tasks.scripts.Bash
          commands:
            - 'exit 1'
